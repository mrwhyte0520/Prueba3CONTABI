import{u as M,a as O,r as o,s as u,j as e}from"./index-CQa-GowG.js";const I=()=>{const{user:x}=M(),C=O(),[c,i]=o.useState([]),[k,b]=o.useState(!0),[S,h]=o.useState(!1),[l,d]=o.useState(null),[f,P]=o.useState(""),[g,D]=o.useState("all"),[p,E]=o.useState(""),[n,m]=o.useState({name:"",start_date:"",end_date:"",fiscal_year:new Date().getFullYear().toString()});o.useEffect(()=>{F()},[x]);const F=async()=>{if(x)try{b(!0);const{data:s,error:t}=await u.from("accounting_periods").select("*").eq("user_id",x.id).order("start_date",{ascending:!1});if(!t&&s)i(s);else throw new Error("Error loading from Supabase")}catch(s){console.error("Error loading periods:",s),q()}finally{b(!1)}},q=()=>{i([])},A=(s,t)=>!s||!t?"Debe especificar fecha de inicio y fin":new Date(s)>=new Date(t)?"La fecha de inicio debe ser anterior a la fecha de fin":c.some(r=>{const j=new Date(r.start_date),B=new Date(r.end_date),Y=new Date(s),$=new Date(t);return Y<=B&&$>=j})?"El período se solapa con un período existente":null,L=async()=>{if(x)try{const s=A(n.start_date,n.end_date);if(s){alert(s);return}if(!n.name.trim()){alert("Debe especificar un nombre para el período");return}const t={id:Date.now().toString(),name:n.name,start_date:n.start_date,end_date:n.end_date,status:"open",fiscal_year:n.fiscal_year,created_at:new Date().toISOString(),entries_count:0,total_debits:0,total_credits:0};try{const{data:a,error:r}=await u.from("accounting_periods").insert([{user_id:x.id,name:t.name,start_date:t.start_date,end_date:t.end_date,status:t.status,fiscal_year:t.fiscal_year}]).select().single();if(r)throw r;i(j=>[{...t,id:a.id},...j])}catch(a){console.error("Supabase error:",a),i(r=>[t,...r])}m({name:"",start_date:"",end_date:"",fiscal_year:new Date().getFullYear().toString()}),h(!1),alert("Período contable creado exitosamente")}catch(s){console.error("Error creating period:",s),alert("Error al crear el período contable")}},y=async s=>{if(confirm("¿Está seguro de que desea cerrar este período? Esta acción no se puede deshacer."))try{const t={status:"closed",closed_at:new Date().toISOString(),closed_by:"Admin"};try{const{error:a}=await u.from("accounting_periods").update(t).eq("id",s);if(a)throw a}catch(a){console.error("Supabase error:",a)}i(a=>a.map(r=>r.id===s?{...r,...t}:r)),alert("Período cerrado exitosamente")}catch(t){console.error("Error closing period:",t),alert("Error al cerrar el período")}},N=async s=>{if(confirm("¿Está seguro de que desea bloquear este período? No se podrán realizar más cambios."))try{const t={status:"locked"};try{const{error:a}=await u.from("accounting_periods").update(t).eq("id",s);if(a)throw a}catch(a){console.error("Supabase error:",a)}i(a=>a.map(r=>r.id===s?{...r,...t}:r)),alert("Período bloqueado exitosamente")}catch(t){console.error("Error locking period:",t),alert("Error al bloquear el período")}},v=async s=>{if(confirm("¿Está seguro de que desea reabrir este período?"))try{const t={status:"open",closed_at:void 0,closed_by:void 0};try{const{error:a}=await u.from("accounting_periods").update(t).eq("id",s);if(a)throw a}catch(a){console.error("Supabase error:",a)}i(a=>a.map(r=>r.id===s?{...r,...t}:r)),alert("Período reabierto exitosamente")}catch(t){console.error("Error reopening period:",t),alert("Error al reabrir el período")}},T=c.filter(s=>{const t=s.name.toLowerCase().includes(f.toLowerCase()),a=g==="all"||s.status===g,r=!p||s.fiscal_year===p;return t&&a&&r}),w=s=>{switch(s){case"open":return"bg-green-100 text-green-800";case"closed":return"bg-yellow-100 text-yellow-800";case"locked":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},_=s=>{switch(s){case"open":return"Abierto";case"closed":return"Cerrado";case"locked":return"Bloqueado";default:return"Desconocido"}},R=[...new Set(c.map(s=>s.fiscal_year))].sort().reverse();return k?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>C("/accounting"),className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx("i",{className:"ri-arrow-left-line"}),"Volver a Contabilidad"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Períodos Contables"}),e.jsx("p",{className:"text-gray-600",children:"Gestión de períodos fiscales"})]})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx("i",{className:"ri-add-line"}),"Nuevo Período"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"ri-calendar-check-line text-2xl text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Períodos Abiertos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.filter(s=>s.status==="open").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("i",{className:"ri-calendar-close-line text-2xl text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Períodos Cerrados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.filter(s=>s.status==="closed").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"ri-lock-line text-2xl text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Períodos Bloqueados"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.filter(s=>s.status==="locked").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Asientos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:c.reduce((s,t)=>s+(t.entries_count||0),0)})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx("i",{className:"ri-calendar-line text-2xl text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Año Fiscal Actual"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Date().getFullYear()})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar períodos...",value:f,onChange:s=>P(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:g,onChange:s=>D(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"open",children:"Abiertos"}),e.jsx("option",{value:"closed",children:"Cerrados"}),e.jsx("option",{value:"locked",children:"Bloqueados"})]}),e.jsxs("select",{value:p,onChange:s=>E(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-8",children:[e.jsx("option",{value:"",children:"Todos los años"}),R.map(s=>e.jsx("option",{value:s,children:s},s))]})]})})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Período"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Inicio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha Fin"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Año Fiscal"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Asientos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Movimientos"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:T.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.start_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.end_date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.fiscal_year}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${w(s.status)}`,children:_(s.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.entries_count||0}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["RD$",((s.total_debits||0)+(s.total_credits||0)).toLocaleString()]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>d(s),className:"text-blue-600 hover:text-blue-900",title:"Ver detalles",children:e.jsx("i",{className:"ri-eye-line"})}),s.status==="open"&&e.jsx("button",{onClick:()=>y(s.id),className:"text-yellow-600 hover:text-yellow-900",title:"Cerrar período",children:e.jsx("i",{className:"ri-calendar-close-line"})}),s.status==="closed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(s.id),className:"text-red-600 hover:text-red-900",title:"Bloquear período",children:e.jsx("i",{className:"ri-lock-line"})}),e.jsx("button",{onClick:()=>v(s.id),className:"text-green-600 hover:text-green-900",title:"Reabrir período",children:e.jsx("i",{className:"ri-calendar-check-line"})})]})]})})]},s.id))})]})})]}),S&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Nuevo Período Contable"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Período"}),e.jsx("input",{type:"text",value:n.name,onChange:s=>m(t=>({...t,name:s.target.value})),placeholder:"Ej: Enero 2025",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Inicio"}),e.jsx("input",{type:"date",value:n.start_date,onChange:s=>m(t=>({...t,start_date:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Fin"}),e.jsx("input",{type:"date",value:n.end_date,onChange:s=>m(t=>({...t,end_date:s.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Año Fiscal"}),e.jsx("input",{type:"number",value:n.fiscal_year,onChange:s=>m(t=>({...t,fiscal_year:s.target.value})),min:"2020",max:"2030",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 mt-6",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:L,disabled:!n.name||!n.start_date||!n.end_date,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:"Crear Período"})]})]})]})}),l&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900",children:["Detalles del Período: ",l.name]}),e.jsx("button",{onClick:()=>d(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Información General"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Período:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:l.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Fecha Inicio:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:new Date(l.start_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Fecha Fin:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:new Date(l.end_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Año Fiscal:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:l.fiscal_year})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Estado:"}),e.jsx("span",{className:`ml-2 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${w(l.status)}`,children:_(l.status)})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Estadísticas del Período"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Asientos:"}),e.jsx("span",{className:"ml-2 text-sm font-bold text-gray-900",children:l.entries_count||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Débitos:"}),e.jsxs("span",{className:"ml-2 text-sm font-bold text-green-600",children:["RD$",(l.total_debits||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Total Créditos:"}),e.jsxs("span",{className:"ml-2 text-sm font-bold text-red-600",children:["RD$",(l.total_credits||0).toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Creado:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:new Date(l.created_at).toLocaleDateString()})]}),l.closed_at&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Cerrado:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:new Date(l.closed_at).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Cerrado por:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:l.closed_by})]})]})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"space-x-2",children:[l.status==="open"&&e.jsxs("button",{onClick:()=>{y(l.id),d(null)},className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors",children:[e.jsx("i",{className:"ri-calendar-close-line mr-2"}),"Cerrar Período"]}),l.status==="closed"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{N(l.id),d(null)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[e.jsx("i",{className:"ri-lock-line mr-2"}),"Bloquear Período"]}),e.jsxs("button",{onClick:()=>{v(l.id),d(null)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("i",{className:"ri-calendar-check-line mr-2"}),"Reabrir Período"]})]})]}),e.jsx("button",{onClick:()=>d(null),className:"px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors",children:"Cerrar"})]})})]})]})})]})};export{I as default};
//# sourceMappingURL=page-KlNt2gbS.js.map
