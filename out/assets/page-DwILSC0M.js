import{a as $,u as A,r as c,j as e,D as v}from"./index-CQa-GowG.js";function I(){const w=$();A();const[k,b]=c.useState(!0),[m,_]=c.useState(""),[j,S]=c.useState(new Date().toISOString().split("T")[0]),[R,F]=c.useState(null),[o,h]=c.useState([]),[x,g]=c.useState([]),[L,C]=c.useState([]),[D,p]=c.useState(!1),B=[],[l,u]=c.useState({type:"bank_charge",description:"",amount:"",date:new Date().toISOString().split("T")[0]});c.useEffect(()=>{f()},[m,j]);const f=async()=>{if(!m){b(!1);return}b(!0);try{h([]),g([])}catch(t){console.error("Error loading reconciliation data:",t)}finally{b(!1)}},y=(t,s)=>{h(n=>n.map(r=>r.id===t?{...r,is_matched:!0,match_id:s}:r)),g(n=>n.map(r=>r.id===s?{...r,is_matched:!0,match_id:t}:r))},N=(t,s)=>{if(s==="book"){const n=o.find(r=>r.id===t);n?.match_id&&g(r=>r.map(a=>a.id===n.match_id?{...a,is_matched:!1,match_id:void 0}:a)),h(r=>r.map(a=>a.id===t?{...a,is_matched:!1,match_id:void 0}:a))}else{const n=x.find(r=>r.id===t);n?.match_id&&h(r=>r.map(a=>a.id===n.match_id?{...a,is_matched:!1,match_id:void 0}:a)),g(r=>r.map(a=>a.id===t?{...a,is_matched:!1,match_id:void 0}:a))}},M=async t=>{t.preventDefault();try{const s={id:Date.now().toString(),type:l.type,description:l.description,amount:parseFloat(l.amount),date:l.date,created_at:new Date().toISOString()};C(r=>[...r,s]);const n={id:`adj_${Date.now()}`,type:"book",date:l.date,description:`Ajuste: ${l.description}`,amount:l.type==="bank_charge"?-Math.abs(parseFloat(l.amount)):Math.abs(parseFloat(l.amount)),is_matched:!1};h(r=>[...r,n]),u({type:"bank_charge",description:"",amount:"",date:new Date().toISOString().split("T")[0]}),p(!1),alert("Ajuste agregado exitosamente.")}catch(s){console.error("Error creating adjustment:",s),alert("Error al crear el ajuste. Intente nuevamente.")}},i=(()=>{const t=o.reduce((a,d)=>a+d.amount,0),s=x.reduce((a,d)=>a+d.amount,0),n=o.filter(a=>!a.is_matched).reduce((a,d)=>a+d.amount,0),r=x.filter(a=>!a.is_matched).reduce((a,d)=>a+d.amount,0);return{bookBalance:t,bankBalance:s,unmatchedBook:n,unmatchedBank:r,difference:t-s,isReconciled:Math.abs(n-r)<.01}})();return k?e.jsx(v,{children:e.jsx("div",{className:"p-6 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando datos de conciliación..."})]})})}):e.jsx(v,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Conciliación Bancaria"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Reconcilie las transacciones del libro con el estado bancario"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:()=>p(!0),className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-settings-line mr-2"}),"Nuevo Ajuste"]}),e.jsxs("button",{onClick:()=>w("/accounting"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors whitespace-nowrap",children:[e.jsx("i",{className:"ri-arrow-left-line mr-2"}),"Volver"]})]})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Banco"}),e.jsxs("select",{value:m,onChange:t=>_(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"",children:"Seleccionar banco"}),B.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.account_number]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha de Conciliación"}),e.jsx("input",{type:"date",value:j,onChange:t=>S(t.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:f,disabled:!m,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors whitespace-nowrap disabled:opacity-50",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Cargar Datos"]})})]})}),m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"ri-book-line text-2xl text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Balance Libro"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["RD$",i.bookBalance.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"ri-bank-line text-2xl text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Balance Banco"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["RD$",i.bankBalance.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx("i",{className:"ri-question-line text-2xl text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Sin Conciliar"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:o.filter(t=>!t.is_matched).length+x.filter(t=>!t.is_matched).length})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg ${Math.abs(i.difference)<.01?"bg-green-100":"bg-red-100"}`,children:e.jsx("i",{className:`ri-calculator-line text-2xl ${Math.abs(i.difference)<.01?"text-green-600":"text-red-600"}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Diferencia"}),e.jsxs("p",{className:`text-xl font-bold ${Math.abs(i.difference)<.01?"text-green-600":"text-red-600"}`,children:["RD$",Math.abs(i.difference).toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg ${i.isReconciled?"bg-green-100":"bg-red-100"}`,children:e.jsx("i",{className:`ri-check-line text-2xl ${i.isReconciled?"text-green-600":"text-red-600"}`})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsx("p",{className:`text-sm font-bold ${i.isReconciled?"text-green-600":"text-red-600"}`,children:i.isReconciled?"Conciliado":"Pendiente"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Transacciones del Libro"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acción"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(t=>e.jsxs("tr",{className:t.is_matched?"bg-green-50":"",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900",children:t.description}),e.jsxs("td",{className:`px-4 py-4 whitespace-nowrap text-sm font-medium ${t.amount>=0?"text-green-600":"text-red-600"}`,children:["RD$",Math.abs(t.amount).toLocaleString()]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.is_matched?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.is_matched?"Conciliado":"Pendiente"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:t.is_matched?e.jsx("button",{onClick:()=>N(t.id,"book"),className:"text-red-600 hover:text-red-900",children:"Deshacer"}):e.jsxs("select",{onChange:s=>s.target.value&&y(t.id,s.target.value),className:"text-sm border border-gray-300 rounded px-2 py-1 pr-8",defaultValue:"",children:[e.jsx("option",{value:"",children:"Conciliar con..."}),x.filter(s=>!s.is_matched&&Math.abs(s.amount-t.amount)<.01).map(s=>e.jsxs("option",{value:s.id,children:[s.description.substring(0,20),"..."]},s.id))]})})]},t.id))})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Estado Bancario"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acción"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.map(t=>e.jsxs("tr",{className:t.is_matched?"bg-green-50":"",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900",children:t.description}),e.jsxs("td",{className:`px-4 py-4 whitespace-nowrap text-sm font-medium ${t.amount>=0?"text-green-600":"text-red-600"}`,children:["RD$",Math.abs(t.amount).toLocaleString()]}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.is_matched?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:t.is_matched?"Conciliado":"Pendiente"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium",children:t.is_matched?e.jsx("button",{onClick:()=>N(t.id,"bank"),className:"text-red-600 hover:text-red-900",children:"Deshacer"}):e.jsxs("select",{onChange:s=>s.target.value&&y(s.target.value,t.id),className:"text-sm border border-gray-300 rounded px-2 py-1 pr-8",defaultValue:"",children:[e.jsx("option",{value:"",children:"Conciliar con..."}),o.filter(s=>!s.is_matched&&Math.abs(s.amount-t.amount)<.01).map(s=>e.jsxs("option",{value:s.id,children:[s.description.substring(0,20),"..."]},s.id))]})})]},t.id))})]})})]})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Nuevo Ajuste de Conciliación"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("i",{className:"ri-close-line text-xl"})})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Ajuste *"}),e.jsxs("select",{required:!0,value:l.type,onChange:t=>u(s=>({...s,type:t.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-8",children:[e.jsx("option",{value:"bank_charge",children:"Comisión Bancaria"}),e.jsx("option",{value:"interest_earned",children:"Interés Ganado"}),e.jsx("option",{value:"nsf_fee",children:"Comisión por Fondos Insuficientes"}),e.jsx("option",{value:"service_charge",children:"Cargo por Servicio"}),e.jsx("option",{value:"other",children:"Otro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fecha *"}),e.jsx("input",{type:"date",required:!0,value:l.date,onChange:t=>u(s=>({...s,date:t.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción *"}),e.jsx("input",{type:"text",required:!0,value:l.description,onChange:t=>u(s=>({...s,description:t.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Monto *"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:l.amount,onChange:t=>u(s=>({...s,amount:t.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"flex space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>p(!1),className:"flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg hover:bg-gray-200 transition-colors whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition-colors whitespace-nowrap",children:"Crear Ajuste"})]})]})]})})})]})})}export{I as default};
//# sourceMappingURL=page-DwILSC0M.js.map
