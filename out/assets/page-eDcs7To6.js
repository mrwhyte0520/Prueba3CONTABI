import{j as e,L as B,u as G,r as o,c as E,i as O,a as L,D as $}from"./index-CQa-GowG.js";import{u as U}from"./usePlans-BjhDNhgf.js";function k(){const{currentPlan:n,hasAccess:s}=U(),l=()=>{if(!s()||!n?.active)return{maxCompanies:1,maxUsers:1,maxProducts:50,maxEmployees:0,hasAdvancedReports:!1,hasBankingManagement:!1,hasAdvancedAnalytics:!1,hasPayroll:!1,hasMultiBranch:!1,hasElectronicInvoicing:!1,hasFixedAssets:!1,hasInventoryManagement:!0,hasAccountingPeriods:!0,hasGeneralJournal:!0,hasGeneralLedger:!0,hasChartOfAccounts:!0,hasFinancialStatements:!1,hasBankReconciliation:!1,hasTaxReports:!1,hasAccountsPayable:!1,hasAccountsReceivable:!1,hasBilling:!0,hasPOS:!1};switch(n.id){case"pyme":return{maxCompanies:1,maxUsers:2,maxProducts:500,maxEmployees:0,hasAdvancedReports:!1,hasBankingManagement:!1,hasAdvancedAnalytics:!1,hasPayroll:!1,hasMultiBranch:!1,hasElectronicInvoicing:!1,hasFixedAssets:!0,hasInventoryManagement:!0,hasAccountingPeriods:!0,hasGeneralJournal:!0,hasGeneralLedger:!0,hasChartOfAccounts:!0,hasFinancialStatements:!0,hasBankReconciliation:!1,hasTaxReports:!0,hasAccountsPayable:!1,hasAccountsReceivable:!1,hasBilling:!0,hasPOS:!1};case"pro":return{maxCompanies:3,maxUsers:5,maxProducts:2e3,maxEmployees:10,hasAdvancedReports:!0,hasBankingManagement:!0,hasAdvancedAnalytics:!1,hasPayroll:!0,hasMultiBranch:!1,hasElectronicInvoicing:!1,hasFixedAssets:!0,hasInventoryManagement:!0,hasAccountingPeriods:!0,hasGeneralJournal:!0,hasGeneralLedger:!0,hasChartOfAccounts:!0,hasFinancialStatements:!0,hasBankReconciliation:!0,hasTaxReports:!0,hasAccountsPayable:!0,hasAccountsReceivable:!0,hasBilling:!0,hasPOS:!0};case"plus":case"student":return{maxCompanies:-1,maxUsers:-1,maxProducts:-1,maxEmployees:-1,hasAdvancedReports:!0,hasBankingManagement:!0,hasAdvancedAnalytics:!0,hasPayroll:!0,hasMultiBranch:!0,hasElectronicInvoicing:!0,hasFixedAssets:!0,hasInventoryManagement:!0,hasAccountingPeriods:!0,hasGeneralJournal:!0,hasGeneralLedger:!0,hasChartOfAccounts:!0,hasFinancialStatements:!0,hasBankReconciliation:!0,hasTaxReports:!0,hasAccountsPayable:!0,hasAccountsReceivable:!0,hasBilling:!0,hasPOS:!0};default:return l()}},i=l(),x=r=>i[r],g=(r,c)=>{const d=i[r];if(d===-1)return{allowed:!0,limit:-1};const t=c<d,a=t?void 0:`Has alcanzado el límite de ${d} ${m(r)} para tu plan ${n?.name||"actual"}.`;return{allowed:t,limit:d,message:a}},m=r=>({maxCompanies:"empresas",maxUsers:"usuarios",maxProducts:"productos",maxEmployees:"empleados"})[r]||r;return{limitations:i,checkFeatureAccess:x,checkQuantityLimit:g,getUpgradeMessage:()=>{const r=n?.name||"actual";if(!n?.active)return"Necesitas una suscripción activa para acceder a esta función.";switch(n.id){case"pyme":return`Esta función requiere el plan PRO o superior. Tu plan ${r} no incluye esta característica.`;case"pro":return`Esta función requiere el plan PLUS. Tu plan ${r} no incluye esta característica.`;default:return`Esta función no está disponible en tu plan ${r}.`}},currentPlan:n?.name||"Sin plan"}}function C({children:n,feature:s,fallback:l,showUpgradePrompt:i=!0}){const{checkFeatureAccess:x,getUpgradeMessage:g,currentPlan:m}=k();return x(s)?e.jsx(e.Fragment,{children:n}):l?e.jsx(e.Fragment,{children:l}):i?e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg p-8 text-center border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("i",{className:"ri-lock-line text-4xl text-gray-400 mb-3"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Función No Disponible"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:g()})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 mb-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-center mb-2",children:[e.jsx("i",{className:"ri-vip-crown-line text-blue-500 mr-2"}),e.jsx("span",{className:"font-semibold text-gray-700",children:"Plan Actual"})]}),e.jsx("div",{className:"text-lg font-bold text-blue-600",children:m})]}),e.jsxs(B,{to:"/plans",className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-semibold hover:from-blue-700 hover:to-blue-800 transition-all duration-200 whitespace-nowrap",children:[e.jsx("i",{className:"ri-arrow-up-line mr-2"}),"Actualizar Plan"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-3",children:"Mejora tu plan para acceder a todas las funciones"})]})}):null}function T(){const{user:n}=G(),[s,l]=o.useState(0),[i,x]=o.useState(0),[g,m]=o.useState(0),[N,r]=o.useState(0),[c,d]=o.useState(0);o.useEffect(()=>{(async()=>{try{const h=n?.id||"",b=new Date,F=new Date(b.getFullYear(),b.getMonth(),1),A=new Date(b.getFullYear(),b.getMonth()+1,0),P=F.toISOString().slice(0,10),v=A.toISOString().slice(0,10),[y,S]=await Promise.all([E.generateIncomeStatement(h,P,v),O.getAll(h)]),p=y.totalIncome||0,D=y.totalExpenses||0,I=y.netIncome||0;l(p),x(D),m(I);const M=(S||[]).filter(w=>{const f=(w.status||"").toLowerCase();return f==="pending"||f==="unpaid"||f==="vencida"});r(M.length);const R=M.reduce((w,f)=>w+(f.total_amount||f.total||0),0);d(R)}catch{l(0),x(0),m(0),r(0),d(0)}})()},[n]);const t=a=>new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP"}).format(a);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos del Mes"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:t(s)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-green-600 text-xl"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gastos del Mes"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:t(i)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-shopping-cart-line text-red-600 text-xl"})})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Utilidad Neta"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:t(g)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-line-chart-line text-blue-600 text-xl"})})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Facturas Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:N})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx("i",{className:"ri-file-list-3-line text-orange-600 text-xl"})})]}),e.jsxs("div",{className:"mt-4 flex items-center text-sm",children:[e.jsx("span",{className:"text-orange-600 font-medium",children:t(c)}),e.jsx("span",{className:"text-gray-500 ml-2",children:"por cobrar"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(C,{feature:"hasAdvancedAnalytics",fallback:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ingresos vs Gastos"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-bar-chart-line text-4xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Gráfico disponible en plan PRO"})]})})]}),children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ingresos vs Gastos"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-bar-chart-line text-4xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Gráfico de barras aquí"})]})})]})}),e.jsx(C,{feature:"hasAdvancedAnalytics",fallback:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribución de Gastos"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-pie-chart-line text-4xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Gráfico disponible en plan PRO"})]})})]}),children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribución de Gastos"}),e.jsx("div",{className:"h-64 flex items-center justify-center bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-pie-chart-line text-4xl text-gray-400 mb-2"}),e.jsx("p",{className:"text-gray-500",children:"Gráfico circular aquí"})]})})]})})]})]})}function q(){const{user:n}=G(),[s,l]=o.useState({totalRevenue:0,totalExpenses:0,netProfit:0,pendingInvoices:0,cashFlow:0,profitMargin:0,liquidityRatio:0,efficiency:0,monthlyGrowth:0,customerSatisfaction:0}),[i,x]=o.useState([]),[g,m]=o.useState([]),[N,r]=o.useState(0);o.useEffect(()=>{(async()=>{try{const a=n?.id||"",h=new Date,b=new Date(h.getFullYear(),h.getMonth(),1),F=new Date(h.getFullYear(),h.getMonth()+1,0),A=b.toISOString().slice(0,10),P=F.toISOString().slice(0,10),[v,y,S]=await Promise.all([E.generateIncomeStatement(a,A,P),E.generateCashFlowStatement(a,A,P),O.getAll(a)]),p=v.totalIncome||0,D=v.totalExpenses||0,I=v.netIncome||0,M=y.netCashFlow||0,R=(S||[]).filter(j=>{const u=(j.status||"").toLowerCase();return u==="pending"||u==="unpaid"||u==="vencida"}).length,w=(S||[]).filter(j=>{const u=(j.status||"").toLowerCase();return u==="pending"||u==="unpaid"||u==="vencida"}).reduce((j,u)=>j+(u.total_amount||u.total||0),0),f=p>0?I/p*100:0;l(j=>({...j,totalRevenue:p,totalExpenses:D,netProfit:I,cashFlow:M,pendingInvoices:R,profitMargin:f})),r(w),x([{month:h.toLocaleString("es-DO",{month:"short"}),ingresos:p,gastos:D}]),m([])}catch{x([]),m([])}})()},[n]);const c=t=>new Intl.NumberFormat("es-DO",{style:"currency",currency:"DOP"}).format(t),d=t=>`${t.toFixed(1)}%`;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos Totales"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:c(s.totalRevenue)})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-2xl text-green-600"})})]}),e.jsxs("div",{className:"mt-4 flex items-center",children:[e.jsxs("span",{className:"text-sm text-green-600 font-medium",children:["+",d(s.monthlyGrowth)]}),e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"vs mes anterior"})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gastos Totales"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c(s.totalExpenses)})]}),e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-2xl text-red-600"})})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Utilidad Neta"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c(s.netProfit)})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-line-chart-line text-2xl text-blue-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsxs("span",{className:"text-sm text-blue-600 font-medium",children:["Margen: ",d(s.profitMargin)]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Facturas Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:s.pendingInvoices})]}),e.jsx("div",{className:"w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center",children:e.jsx("i",{className:"ri-file-list-3-line text-2xl text-orange-600"})})]}),e.jsx("div",{className:"mt-4 flex items-center",children:e.jsxs("span",{className:"text-sm text-orange-600 font-medium",children:["Valor: ",c(N)]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Ingresos vs Gastos"}),(()=>{const t=Math.max(1,...i.flatMap(a=>[a.ingresos,a.gastos]));return e.jsx("div",{className:"h-64 flex items-end justify-between space-x-2",children:i.map((a,h)=>e.jsxs("div",{className:"flex flex-col items-center space-y-2 flex-1",children:[e.jsxs("div",{className:"flex items-end space-x-1 h-48",children:[e.jsx("div",{className:"bg-green-500 rounded-t w-4",style:{height:`${Math.min(a.ingresos/t*100,100)}%`},title:`Ingresos: ${c(a.ingresos)}`}),e.jsx("div",{className:"bg-red-500 rounded-t w-4",style:{height:`${Math.min(a.gastos/t*100,100)}%`},title:`Gastos: ${c(a.gastos)}`})]}),e.jsx("span",{className:"text-xs text-gray-600",children:a.month})]},h))})})(),e.jsxs("div",{className:"flex justify-center space-x-6 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Ingresos"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Gastos"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Distribución de Gastos"}),e.jsx("div",{className:"space-y-4",children:g.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:t.color}}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:t.category})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:c(t.amount)}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(t.amount/s.totalExpenses*100).toFixed(1),"%"]})]})]},a))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Liquidez"}),e.jsx("i",{className:"ri-drop-line text-2xl text-blue-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:s.liquidityRatio.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Ratio de liquidez corriente"}),e.jsx("div",{className:"mt-4 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(s.liquidityRatio/3*100,100)}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Rentabilidad"}),e.jsx("i",{className:"ri-percent-line text-2xl text-green-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:d(s.profitMargin)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Margen de utilidad"}),e.jsx("div",{className:"mt-4 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${s.profitMargin}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Eficiencia"}),e.jsx("i",{className:"ri-speed-line text-2xl text-purple-600"})]}),e.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:d(s.efficiency)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Eficiencia operacional"}),e.jsx("div",{className:"mt-4 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${s.efficiency}%`}})})]})]})]})}function V(){const[n,s]=o.useState("advanced"),{checkFeatureAccess:l}=k(),{signOut:i}=G(),x=L();l("hasAdvancedAnalytics");const g=async()=>{try{await i(),x("/login")}catch(m){console.error("Error al cerrar sesión:",m)}};return e.jsx($,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-navy-700 to-navy-800 rounded-lg p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-navy-200",children:"Panel de control y métricas de tu empresa"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex bg-white/10 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>s("advanced"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${n==="advanced"?"bg-white text-navy-700 shadow-sm":"text-white hover:bg-white/10"}`,children:[e.jsx("i",{className:"ri-dashboard-3-line mr-2"}),"KPI Avanzado"]}),e.jsxs("button",{onClick:()=>s("basic"),className:`px-4 py-2 rounded-md text-sm font-medium transition-all whitespace-nowrap ${n==="basic"?"bg-white text-navy-700 shadow-sm":"text-white hover:bg-white/10"}`,children:[e.jsx("i",{className:"ri-dashboard-line mr-2"}),"Básico"]})]}),e.jsxs("button",{onClick:g,className:"flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all duration-200 shadow-lg hover:shadow-xl whitespace-nowrap",children:[e.jsx("i",{className:"ri-logout-box-line mr-2"}),"Cerrar Sesión"]})]})]})}),n==="advanced"?e.jsx(q,{}):e.jsx(T,{})]})})}export{V as default};
//# sourceMappingURL=page-eDcs7To6.js.map
