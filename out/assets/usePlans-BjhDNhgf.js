import{r as l}from"./index-CQa-GowG.js";function S(){const[o,u]=l.useState(null),[s,i]=l.useState({isActive:!0,daysLeft:15,hoursLeft:0,minutesLeft:0,startDate:new Date,endDate:new Date(Date.now()+360*60*60*1e3),hasExpired:!1}),d=e=>{const r=new Date,t=e.getTime()-r.getTime();if(t<=0)return{daysLeft:0,hoursLeft:0,minutesLeft:0,isActive:!1,hasExpired:!0};const n=Math.floor(t/(1e3*60*60*24)),a=Math.floor(t%(1e3*60*60*24)/(1e3*60*60)),c=Math.floor(t%(1e3*60*60)/(1e3*60));return{daysLeft:n,hoursLeft:a,minutesLeft:c,isActive:t>0,hasExpired:!1}};l.useEffect(()=>{const e=()=>{const t=localStorage.getItem("contard_trial_info"),n=localStorage.getItem("contard_current_plan");if(n)try{const a=JSON.parse(n);u(a)}catch(a){console.error("Error parsing saved plan:",a),localStorage.removeItem("contard_current_plan")}if(t)try{const a=JSON.parse(t),c=new Date(a.endDate),f=new Date(a.startDate);if(isNaN(c.getTime())||isNaN(f.getTime()))throw new Error("Invalid dates");const E=d(c);i({startDate:f,endDate:c,...E})}catch(a){console.error("Error parsing trial info:",a),r()}else r()},r=()=>{const t=new Date,n=new Date(Date.now()+360*60*60*1e3),a={isActive:!0,daysLeft:15,hoursLeft:0,minutesLeft:0,startDate:t,endDate:n,hasExpired:!1};localStorage.setItem("contard_trial_info",JSON.stringify({startDate:t.toISOString(),endDate:n.toISOString()})),i(a)};e()},[]),l.useEffect(()=>{const e=()=>{if(s.endDate&&!o?.active){const t=d(s.endDate);i(n=>({...n,...t})),t.hasExpired&&localStorage.setItem("contard_trial_expired","true")}};e();const r=setInterval(e,6e4);return()=>clearInterval(r)},[s.endDate,o?.active]);const p=async e=>{try{if(s.hasExpired&&!o?.active)return{success:!1,error:"El período de prueba ha expirado. Debe completar el pago para continuar."};console.log("Subscribing to plan:",e);const r={id:e,name:e.toUpperCase(),price:D(e),features:b(e),active:!0};return u(r),i(t=>({...t,isActive:!1,hasExpired:!1})),localStorage.setItem("contard_current_plan",JSON.stringify(r)),localStorage.removeItem("contard_trial_expired"),{success:!0}}catch(r){return console.error("Error subscribing to plan:",r),{success:!1,error:"Error al procesar la suscripción"}}},m=async()=>{try{return u(null),localStorage.removeItem("contard_current_plan"),i(e=>({...e,isActive:!1,hasExpired:!0,daysLeft:0,hoursLeft:0,minutesLeft:0})),localStorage.setItem("contard_trial_expired","true"),{success:!0}}catch(e){return console.error("Error canceling subscription:",e),{success:!1,error:"Error al cancelar la suscripción"}}},v=()=>o?.active===!0||s.isActive&&!s.hasExpired,g=()=>o?.active===!0||!s.hasExpired,h=()=>o?.active?"subscribed":s.hasExpired?"expired":s.daysLeft<=3?"warning":"active",D=e=>({pyme:19.97,pro:49.97,plus:99.97,student:49.97})[e]||0,b=e=>({pyme:["Una empresa","Facturación básica con NCF","Dashboard básico","Reportes DGII básicos","Inventario limitado (500 productos)","2 usuarios"],pro:["3 empresas","Contabilidad completa","Dashboard básico","Gestión bancaria básica","Inventario limitado (2,000 productos)","Nómina básica (10 empleados)","5 usuarios"],plus:["Empresas ilimitadas","Todas las funciones contables","Dashboard KPI avanzado","Inventario ilimitado","Nómina completa","Análisis financiero avanzado","Usuarios ilimitados"],student:["Empresas ilimitadas","Todas las funciones contables","Dashboard KPI avanzado","Inventario ilimitado","Nómina completa","Análisis financiero avanzado","Válido con ID estudiantil","Usuarios ilimitados"]})[e]||[];return{currentPlan:o,trialInfo:s,subscribeToPlan:p,cancelSubscription:m,hasAccess:v,canSelectPlan:g,getTrialStatus:h}}export{S as u};
//# sourceMappingURL=usePlans-BjhDNhgf.js.map
