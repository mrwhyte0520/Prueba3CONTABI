import{u as k,a as M,r as c,s as F,j as e}from"./index-CQa-GowG.js";const q=()=>{const{user:x}=k(),w=M(),[d,j]=c.useState([]),[s,S]=c.useState(null),[r,y]=c.useState([]),[$,N]=c.useState(!0),[m,L]=c.useState(""),[g,D]=c.useState("all"),[h,f]=c.useState(""),[p,v]=c.useState("");c.useEffect(()=>{C()},[x]),c.useEffect(()=>{s&&A(s.id)},[s,h,p]);const C=async()=>{if(x)try{N(!0);const{data:t,error:a}=await F.from("chart_accounts").select("*").eq("user_id",x.id).eq("is_active",!0).order("code");if(!a&&t){const l=t.map(n=>({id:n.id,code:n.code,name:n.name,type:n.type,balance:n.balance||0,normalBalance:n.normal_balance||"debit"}));j(l)}else throw new Error("Error loading from Supabase")}catch(t){console.error("Error loading accounts:",t),j([])}finally{N(!1)}},A=async t=>{if(x)try{y([])}catch(a){console.error("Error loading ledger entries:",a),y([])}},E=()=>{try{if(!s){alert("Por favor seleccione una cuenta primero");return}let t=`Mayor General - ${s.code} ${s.name}
`;t+=`Período: ${h||"Inicio"} - ${p||"Actual"}
`,t+=`Tipo de Cuenta: ${u(s.type)}
`,t+=`Balance Normal: ${s.normalBalance==="debit"?"Débito":"Crédito"}

`,t+=`Fecha,Asiento,Descripción,Referencia,Débito,Crédito,Balance
`,r.forEach(i=>{const o=[new Date(i.date).toLocaleDateString(),i.entryNumber,`"${i.description}"`,i.reference,i.debit>0?i.debit.toLocaleString():"",i.credit>0?i.credit.toLocaleString():"",Math.abs(i.balance).toLocaleString()].join(",");t+=o+`
`}),t+=`
Totales:,,,`,t+=`,${r.reduce((i,o)=>i+o.debit,0).toLocaleString()}`,t+=`,${r.reduce((i,o)=>i+o.credit,0).toLocaleString()}`,t+=`,${Math.abs(r[r.length-1]?.balance||0).toLocaleString()}`,t+=`

Resumen:
`,t+=`Total Movimientos:,${r.length}
`,t+=`Balance Final:,RD$${Math.abs(s.balance).toLocaleString()}
`,t+=`Saldo ${s.normalBalance==="debit"?"Deudor":"Acreedor"}:,${s.balance>=0?"Sí":"No"}
`;const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=document.createElement("a"),n=URL.createObjectURL(a);l.setAttribute("href",n),l.setAttribute("download",`mayor_${s.code}_${new Date().toISOString().split("T")[0]}.csv`),l.style.visibility="hidden",document.body.appendChild(l),l.click(),document.body.removeChild(l)}catch(t){console.error("Error downloading Excel:",t),alert("Error al descargar el archivo")}},T=d.filter(t=>{const a=t.code.toLowerCase().includes(m.toLowerCase())||t.name.toLowerCase().includes(m.toLowerCase()),l=g==="all"||t.type===g;return a&&l}),R={asset:"Activo",liability:"Pasivo",equity:"Patrimonio",income:"Ingreso",expense:"Gasto"},u=t=>R[t]||t,B=t=>({asset:"bg-blue-100 text-blue-800",liability:"bg-red-100 text-red-800",equity:"bg-green-100 text-green-800",income:"bg-purple-100 text-purple-800",expense:"bg-orange-100 text-orange-800"})[t]||"bg-gray-100 text-gray-800",b=(t,a)=>{const l=t>=0;return a==="debit"&&l||a==="credit"&&!l?"text-green-600":"text-red-600"};return $?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>w("/accounting"),className:"flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors",children:[e.jsx("i",{className:"ri-arrow-left-line"}),"Volver a Contabilidad"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Mayor General"}),e.jsx("p",{className:"text-gray-600",children:"Movimientos por cuenta contable"})]})]}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx("i",{className:"ri-file-excel-2-line"}),"Exportar Excel"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx("i",{className:"ri-safe-line text-2xl text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Activos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.filter(t=>t.type==="asset").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx("i",{className:"ri-bank-line text-2xl text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pasivos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.filter(t=>t.type==="liability").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx("i",{className:"ri-funds-line text-2xl text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Patrimonio"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.filter(t=>t.type==="equity").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx("i",{className:"ri-money-dollar-circle-line text-2xl text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ingresos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.filter(t=>t.type==="income").length})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx("i",{className:"ri-shopping-cart-line text-2xl text-orange-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Gastos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:d.filter(t=>t.type==="expense").length})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Catálogo de Cuentas"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar cuenta...",value:m,onChange:t=>L(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("select",{value:g,onChange:t=>D(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-8",children:[e.jsx("option",{value:"all",children:"Todos los tipos"}),e.jsx("option",{value:"asset",children:"Activos"}),e.jsx("option",{value:"liability",children:"Pasivos"}),e.jsx("option",{value:"equity",children:"Patrimonio"}),e.jsx("option",{value:"income",children:"Ingresos"}),e.jsx("option",{value:"expense",children:"Gastos"})]})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:T.map(t=>e.jsx("div",{onClick:()=>S(t),className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors ${s?.id===t.id?"bg-blue-50 border-blue-200":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-gray-900 text-sm",children:[t.code," - ",t.name]}),e.jsx("div",{className:"flex items-center mt-1",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${B(t.type)}`,children:u(t.type)})})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-sm font-medium ${b(t.balance,t.normalBalance)}`,children:["RD$",Math.abs(t.balance).toLocaleString()]}),e.jsx("div",{className:`text-xs ${t.balance>=0?"text-green-600":"text-red-600"}`,children:t.normalBalance==="debit"?"Débito":"Crédito"})]})]})},t.id))})]})}),e.jsx("div",{className:"lg:col-span-2",children:s?e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Mayor de la Cuenta: ",s.code," - ",s.name]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Tipo: ",u(s.type)," | Balance Normal: ",s.normalBalance==="debit"?"Débito":"Crédito"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Balance Actual"}),e.jsxs("div",{className:`text-xl font-bold ${b(s.balance,s.normalBalance)}`,children:["RD$",Math.abs(s.balance).toLocaleString()]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Desde"}),e.jsx("input",{type:"date",value:h,onChange:t=>f(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha Hasta"}),e.jsx("input",{type:"date",value:p,onChange:t=>v(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{f(""),v("")},className:"px-4 py-2 text-sm text-gray-600 hover:text-gray-900 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors whitespace-nowrap",children:"Limpiar Filtros"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fecha"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Asiento"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripción"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Referencia"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Débito"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Crédito"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Balance"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length>0?r.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:t.entryNumber}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.reference}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.debit>0?`RD$${t.debit.toLocaleString()}`:"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.credit>0?`RD$${t.credit.toLocaleString()}`:"-"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:["RD$",Math.abs(t.balance).toLocaleString()]})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("i",{className:"ri-file-list-line text-4xl text-gray-300 mb-2"}),e.jsx("p",{children:"No hay movimientos para esta cuenta en el período seleccionado"})]})})})}),r.length>0&&e.jsx("tfoot",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"px-6 py-3 text-right font-medium text-gray-900",children:"Totales:"}),e.jsxs("td",{className:"px-6 py-3 font-bold text-gray-900",children:["RD$",r.reduce((t,a)=>t+a.debit,0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-3 font-bold text-gray-900",children:["RD$",r.reduce((t,a)=>t+a.credit,0).toLocaleString()]}),e.jsxs("td",{className:"px-6 py-3 font-bold text-gray-900",children:["RD$",Math.abs(r[r.length-1]?.balance||0).toLocaleString()]})]})})]})}),r.length>0&&e.jsx("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Movimientos"}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:r.length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Débitos"}),e.jsxs("div",{className:"text-lg font-bold text-green-600",children:["RD$",r.reduce((t,a)=>t+a.debit,0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Créditos"}),e.jsxs("div",{className:"text-lg font-bold text-red-600",children:["RD$",r.reduce((t,a)=>t+a.credit,0).toLocaleString()]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Balance Final"}),e.jsxs("div",{className:`text-lg font-bold ${b(s.balance,s.normalBalance)}`,children:["RD$",Math.abs(r[r.length-1]?.balance||0).toLocaleString()]})]})]})})]}):e.jsxs("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[e.jsx("i",{className:"ri-file-list-3-line text-6xl text-gray-300 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Selecciona una Cuenta"}),e.jsx("p",{className:"text-gray-600",children:"Elige una cuenta del catálogo para ver su mayor general con todos los movimientos detallados."})]})})]})]})};export{q as default};
//# sourceMappingURL=page-DbDIFg0C.js.map
